---
title: "robustness analysis: runwise RSA, individual-level"
author: "michael freund"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    theme: spacelab
    highlight: zenburn
---



```{r setup, include = FALSE}

knitr::opts_chunk$set(
  fig.align = 'center', fig.width = 11.5, fig.fullwidth = TRUE, cache = TRUE
)

source(here::here("code", "packages.R"))
source(here("code", "strings.R"))
source(here("code", "funs.R"))
source(here("code", "plots.R"))
source(here("code", "read_atlases.R"))

theme_set(theme_bw(base_size = 14))

## read data ----

hyps <- combo_paste(c("dlpfc", "lppc", "dmfc"), c("R", "L"), c("target", "incongruency"))
hyps.alt <- combo_paste(c("dlpfc.alt", "lppc", "dmfc.alt"), c("R", "L"), c("target", "incongruency"))

blups <- 
  bind_rows(
    read.csv(here("out", "behav", "stroop_blups_rt_group201902.csv"), stringsAsFactors = FALSE),
    read.csv(here("out", "behav", "stroop_blups_rt_group201902_validation.csv"), stringsAsFactors = FALSE) 
  )


data.super <- list(
  cval = read_subj_stats(glm.suffix = "fmriprep_runwise_cv-euclidean-stand_", suffix = ""),
  # crun = read_subj_stats(glm.suffix = "fmriprep_im_run_", suffix = ""),
  orig = read_subj_stats(glm.suffix = "fmriprep_", suffix = "_residual"),
  # glma = read_subj_stats(glm.suffix = "fmriprep_im_run_glmagg_", suffix = "") %>% rename(beta = betas),
  down_crun = read_subj_stats(glm.suffix = "fmriprep_im_run_downsampled_", suffix = ""),
  down_both = read_subj_stats(glm.suffix = "fmriprep_im_run_downsampled_both_", suffix = "")
  # down_wnrun = read_subj_stats(glm.suffix = "fmriprep_im_run_downsampled_wnrun_", suffix = "")
)

# stats.subjs.wn <- 
#   data.table::fread(
#     here("out", "rsa", "stats", "subjs_pro_bias_acc-only_fmriprep_im_run_glmagg-wn_masks.csv")
#     )
# stats.subjs.wn <- stats.subjs.wn[subj %in% subjs.analysis & param %in% c("target", "distractor", "incongruency"), ]
# stats.subjs.wn %<>% dplyr::mutate(
#   roi.hemi = roi, 
#   roi = gsub("_L|_R", "", roi), 
#   hemi = ifelse(grepl("_L", roi.hemi), "L", "R")
# )
# # stats.subjs.wn$beta <- (stats.subjs.wn$betas1 + stats.subjs.wn$betas2) / 2
# stats.subjs.wn$beta <- stats.subjs.wn$betas1
# stats.subjs.wn %<>% select(-betas1, -betas2)
# 
# data.super$wn <- stats.subjs.wn

```


# intro



# original (fmriprep)

```{r, echo = FALSE}
measure <- "orig"
```

`r knitr::spin_child('bivar_superparcel.R')`

# downsampled (within+cross run)

```{r, echo = FALSE}
measure <- "down_both"
```

`r knitr::spin_child('bivar_superparcel.R')`


# downsampled, cross-run

```{r, echo = FALSE}
measure <- "down_crun"
```

`r knitr::spin_child('bivar_superparcel.R')`


# cross-validated

```{r, echo = FALSE}
measure <- "cval"
```

`r knitr::spin_child('bivar_superparcel.R')`
