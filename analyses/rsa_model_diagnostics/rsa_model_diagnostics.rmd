---
  title: "performs diagnostics on representational similarity models"
  output: html_document
---

Variance inflation factors and intercorrelations of regressors are estimated and displayed.
Currently only compares models of biased items.


```{r setup}

library(here)
library(magrittr)
library(dplyr)
library(data.table)
library(ggplot2)
library(mikeutils)
library(car)  ## for variance inflation factor

source(here("code", "_strings.R"))
rsv.models.ltri <- fread(here("out", "rsa", "mods", "rsv_bias_lower-triangles.csv"), data.table = FALSE)
rsv.models.ltri$con.clust <- rsv.models.ltri$congruency | rsv.models.ltri$incongruency

## scale

rsv.models.ltri.s <- rsv.models.ltri
is.regressor <- sapply(rsv.models.ltri.s, is.numeric)
rsv.models.ltri.s[is.regressor] <- lapply(rsv.models.ltri.s[is.regressor], scale)

```

# variance inflation factors

## categorical models

<!-- \[\textbf{y} \sim X_t\] -->

```{r categorical-fit}

tdc  <- lm(1:nrow(rsv.models.ltri) ~ target + distractor + congruency, rsv.models.ltri)
tdi  <- update(tdc, . ~ . - congruency + incongruency)
tdci <- update(tdc, . ~ . + incongruency)
tdcon.clust <- update(tdc, . ~ . - congruency + con.clust)

## interaction models

txi  <- update(tdi, . ~ . + incongruency * target)
dxi  <- update(tdi, . ~ . + incongruency * distractor)

txic  <- update(tdci, . ~ . + incongruency : target)
dxic  <- update(tdci, . ~ . + incongruency : distractor)

txi.s <- update(txi, . ~ ., rsv.models.ltri.s)  ## scaled
dxi.s <- update(dxi, . ~ ., rsv.models.ltri.s)

txic.s <- update(txic, . ~ ., rsv.models.ltri.s)  ## scaled
dxic.s <- update(dxic, . ~ ., rsv.models.ltri.s)

```

```{r categorical-out}

## raw

vif(tdc)
vif(tdi)
vif(tdci)

## interaction

vif(txi)
vif(dxi)

vif(txic)
vif(dxic)

## scaled

vif(txi.s)
vif(dxi.s)

vif(txic.s)
vif(dxic.s)

```

## continuous models

```{r continuous-fit}

continuous.all <- lm(
  1:nrow(rsv.models.ltri) ~ 
    cielab + tphono +
    silhou + orthog + dphono +
    incongruency + congruency,  ## model out congruency effects
  rsv.models.ltri
    )

continuous.equiv <- lm(  ## sans orthog
  1:nrow(rsv.models.ltri) ~ 
    cielab + tphono +
    silhou + dphono +
    incongruency + congruency,  ## model out congruency effects
  rsv.models.ltri
    )

```

```{r continuous-out}

vif(continuous.all)
vif(continuous.equiv)

```


## "all regressors" model: categorical + continuous

```{r all-fit}

all <- lm(
  1:nrow(rsv.models.ltri) ~ 
    target + cielab + tphono +
    distractor + silhou + orthog + dphono +
    incongruency + congruency,
  rsv.models.ltri
    )

```


```{r all-out}
vif(all)
```

# associations

```{r}

## pearson and spearman

R.pearson <- round(cor(rsv.models.ltri[is.regressor]), 2)
R.spearman <- round(cor(rsv.models.ltri[is.regressor], method = "spearman"), 2)

## kendall's tau-a

X <- rsv.models.ltri[is.regressor]
R.taua <- matrix(NA, nrow = ncol(X), ncol = ncol(X))
dimnames(R.taua) <- list(names(X), names(X))
for (ii in seq_along(X)) {
  for (jj in seq_along(X)) {
    R.taua[ii, jj] <- DescTools::KendallTauA(X[[ii]], X[[jj]])
  }
}

R.pearson
corrplot::corrplot(R.pearson, method = "number", main = "pearson")

R.spearman
corrplot::corrplot(R.spearman, method = "number", main = "spearman")

R.taua
corrplot::corrplot(R.taua, method = "number", main = "tau-a")

as.table(X[[ii]], X[[jj]])

```

Note: Kendall's Tau-a will not equal 1 when ties exist.


# conclusions

* all categorical models are within acceptable range of colliniarity
* continuous models are highly correlated, especially distractor models.
* but, power may still be preserved within comparisons among target coding models (target, cielab, tphono)
* categorical interactions (target by incongruency, distractor by incongruency) are within acceptable range of colliniarity.
  * however, these interactions coefficients indicate the change in _within-category_ correlation from C to I
  * this difference is rendered uninterpretable because the absolute value of the pattern correlation is difficult to interpret (is biased; dependent upon ROI, subject, SNR...)
